# Базы данных. Лабораторная работа № 3

## Описание базы данных

### Велопрокат

Создать базу данных велопроката, содержащую информацию об аренде велосипедов клиентами.

Информация о велосипедах (таблица `bicycles`) включает следующие поля:
- идентификатор (столбец `bicycle_id`);
- серийный номер (`serial_number`);
- модель (`model_id`) (поле выбирается из справочника `models`).

Справочник моделей (`models`) велосипедов содержит:
- идентификатор (`model_id`)
- название (`model_title`).

У велопроката есть несколько точек выдачи (`rental_points`), которые 
описываются следующими полями:
- идентификатор (`point_id`);
- название (`point_title`);
- координаты расположения: широта (`lat`) и долгота (`lon`);
- заметки (`notes`) для хранения информации в JSON-виде (поле типа *json*).

Информация о клиентах (таблица `customers`) включает следующие поля:
- идентификатор (`customer_id`);
- номер паспорта (`passport`);
- имя (`first_name`);
- фамилия (`last_name`);
- телефон (`phone`).

При аренде велосипеда клиентом в таблице аренды (`rental`) фиксируется:
- идентификатор выданного велосипеда (`bicycle_id`),
- клиент (`customer_id`);
- точка выдачи (`pick_point_id`);
- точка возврата (`return_point_id`);
- время начала аренды (`start_time`);
- время окончания аренды (`end_time`).

Поля, соответствующие времени окончания аренды и точке возврата, в таблице
аренды заполняются после сдачи велосипеда. Точки выдачи и возврата
велосипеда могут быть разными.

## Создание базы данных

Создать базу данных по описанию предметной области, представленной в варианте задания. Создать необходимые первичные и внешние ключи.

Использовать указанное в задании именование таблиц и столбцов.

Сформировать ER-диаграмму построенной БД.

## Добавление/редактирование/удаление данных

Написать запросы:
- добавления данных в таблицы.
- изменения данных в таблицах (по идентификатору).
- удаления данных в таблицах (по идентификатору, всех).

## Запросы

### Запрос 1

Вывести информацию о количестве велосипедов **каждой** модели. В запросе вывести
столбцы: 
- название модели;
- количество велосипедов (столбец назвать `count`).

### Запрос 2

Вывести информацию обо всех точках выдачи (без повторений), откуда брали в
аренду велосипеды модели «**Bianchi Oltre**», упорядочить по названию точки. В
запросе вывести столбцы: 
- идентификатор точки;
- название точки.

### Запрос 3

Вывести суммарное время аренды велосипедов каждой модели **в часах**, упорядочить
по времени аренды. Не учитывать в запросе велосипеды, которые сейчас в аренде
(не вернулись из аренды). В запросе вывести столбцы: 
- название модели;
- суммарное время аренды (столбец назвать `duration`).

### Запрос 4

Вывести информацию о точках выдачи и количестве сданных велосипедов на точке.
Если в точке выдачи не было сдано ни одного велосипеда - в столбце **вывести 0**.
В запросе вывести:
- название точки;
- количество сданных велосипедов (столбец назвать `count`).

### Запрос 5

Вывести информацию о клиентах, бравших велосипеды на прокат больше всего раз
(т.е. вывести всех клиентов, количество аренд для которых было максимальным).
В запросе вывести:
- имя клиента;
- фамилия клиента;
- количество арендованных велосипедов (столбец назвать `count`).

### Запрос 6

Вывести информацию о среднем времени аренды велосипедов (в часах) для каждого
клиента. В запросе вывести клиентов, среднее время аренды которых 
**больше трех часов**. Не учитывать не закончившиеся аренды. В запросе вывести:
- имя клиента;
- фамилия клиента;
- среднее время аренды (столбец назвать `avg`).